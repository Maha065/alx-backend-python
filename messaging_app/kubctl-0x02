#!/bin/bash

# kubctl-0x02
# Objective: Perform a blue-green deployment with zero downtime

echo "=== Deploying BLUE (current) version ==="
kubectl apply -f blue_deployment.yaml

echo "=== Deploying GREEN (new) version ==="
kubectl apply -f green_deployment.yaml

echo "=== Checking running pods ==="
kubectl get pods -l app=django-messaging

echo "=== Checking GREEN pod logs for issues ==="
GREEN_POD=$(kubectl get pods -l app=django-messaging,version=green -o jsonpath="{.items[0].metadata.name}")
kubectl logs "$GREEN_POD" --tail=20

echo "âœ… If logs look good, switch service traffic to GREEN version:"
echo "kubectl apply -f kubeservice.yaml (after changing selector to version: green)"
